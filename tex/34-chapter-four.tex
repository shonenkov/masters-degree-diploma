\chapter{Программа “Spectral Analyzer PK-4”}
\label{cha:ch_4}
\section{Актуальность программы}
В ходе данной работы был создан веб-сервис “Spectral~Analyzer~PK-4”, название которого состоит из двух частей:
первая часть (“Spectral~Analyzer”) обозначает главную задачу сервиса - спектральный анализ, а вторая часть говорит
о том, что анализ осуществляется на данных, полученных с исследуемой в текущей работе экспериментальной установки
“Плазменный~кристалл-4” (PK-4).

Поскольку спектральные данные представляют собой довольно сложную, но упорядоченную структуру данных
(см раздел \ref{cha:ch_3_4}), то ручная обработка и графическое построение даже одного спектра становится
довольно тяжким трудом - необходимо умело ориентироваться в текстовых логах, а также владеть навыками работы
как минимум с двумя программами одновременно - Origin и Exсel. У умелого пользователя данных программ
(при большом желании) получится построить один спектр не быстрее, чем за 5~мин. Так как в одном эксперименте
возможность встретить более 1000~спектров - обычное явление, то даже таких умений становится недостаточно.
Более того, для получения важных физических выводов со спектральных данных, необходимо учитывать шумовой фон,
усреднять идентичные спектры при одних и тех же физических условиях, калибровать шкалы  и др,
от построения полусотни спектров вручную реального продвижения в поставленной задаче не будет.

Таким образом было решено создать автоматизированное компьютеризированное программное обеспечение для решения данной проблемы.

\section{Требования к программе}
Чтобы было не только удобно и практично пользоваться и совершенствовать программу,
а также чтобы достичь решения поставленной задачи, были выдвинуты определенные требования к программе.

Во первых, программа должна обладать свойством кроссплатформенности, т.е. независимо от типа операционной
системы она должна работать корректно. Конкретнее, должна быть возможность работы под следующими операционными
системами: Windows~XP - Windows~10, MacOs, Linux с графической оболочкой.

Во вторых, программа должна иметь возможность сохранения ключевых состояний процесса обработки данных,
а также максимально безболезненно передавать прогресс между пользователями.

Далее, программа должна уметь в автоматическом режиме загружать и парсить текстовые спектральные данные
(эксперименты), а также отображать список уже загруженных экспериментов.

Следующий важнейший аспект - это умение динамически отображать более 1000~спектральных графиков в одном
рабочем окне, отображать метаинформацию по текущему спектру.

Для обработки спектров необходимо учитывать фоновое излучение, поэтому программа должна иметь возможность по
выбранным пользователем номерам спектров усреднять их интенсивности, а также вычитать из всех спектров текущего эксперимента.

Не менее важный аспект - это возможность настроить калибровку спектра по длине волны на основе вводимой пользователем полиномиальной функции.

Далее, для поиска отношений интенсивностей необходимо на основе откалиброванных не зашумленных спектров сохранять
усредненные заготовки с учётом среднеквадратичных погрешностей, также необходимо отображать
список уже сохранённых усредненных спектров.

В силу того, что используемый спектрометр  “OceanOptics~USB2000+” имеет не высокую разрешающую
способность (см раздел \ref{cha:ch_3_4}), то для корректного поиска отношений интенсивностей
необходимо учитывать наложения линий друг на друга с помощью аппаратной функции спектрометра,
т.е. следующее требование к программе: она должна уметь на основе полиномиального приближения аппаратной
функции учитывать перекрытия рядом стоящих линий вместе с погрешностями.

В данной работе особый интерес представляет зависимость отношения интенсивностей определенных линий от энергии
возбужденного состояния, для этого программа должна иметь библиотеку спектральных линий, а также функционал
по выбору набора линий при построении данной зависимости.

Таким образом, мы перечислили основные требования к программе, а сейчас разберем основной стек технологий,
который был изучен для достижения данных целей.

\section{Стек изученных технологий}
Первый прототип программы был написан традиционным образом на языке C\#, который непременно предполагает
стандартную установку под Windows и работу с программой, как с ПО для данной операционной системы.
В данном варианте было реализовано лишь около 20\% необходимого функционала, но при этом возникли большие трудности
с передачей программы научному руководителю из-за несовместимости версий Windows~7 и XP.

Для решения проблем кроссплатформенности и передачи данных между пользователями было решено создать веб-сервис,
который работает в обычном браузере, поскольку почти каждая операционная система с графической оболочкой
поддерживает большинство современных браузеров.

Django (Джанго) — свободный фреймворк для веб-приложений на языке Python, использующий шаблон проектирования MVC.
Проект поддерживается организацией Django Software Foundation \cite{Django}. Джанго имеет удобную гибкую
внутреннюю архитектуру, которая позволяет разработчикам, при достаточных знаниях, выполнять огромный спектр задач
из области веб-программирования. Перечислять все возможности данного фреймворка нет необходимости, подчеркнем лишь те,
что были использованы для решения поставленных задач. Джанго имеет свою стандартизированную ORM, которая поддерживает
транзакции. ORM - это некая оболочка над базой данных,  которая позволяет использовать функционал базы данных
с помощью объектно-ориентированного языка программирования, в данном случае с помощью Python. Далее, в Джанго есть
система маршрутизации урлов, которая позволяет настраивать POST и GET запросы на основе регулярных выражений,
что очень удобно, поскольку в Python есть встроенный модуль “re”, который почти ничем не отличается по синтаксису.